# ShortsAIリポジトリ解析メモ

## 概要
- 目的は最長60秒の縦型ショート動画をテキストから自動生成すること。処理フローはスクリプト分割→画像生成→VOICEVOX音声生成→MoviePyで動画合成→任意でYouTubeアップロード。
- 全モジュールは`config.yaml`の設定値に依存し、出力ディレクトリやAPIキー、レンダリング設定、BGM等を参照する。未配置の場合は実行不可。

## パイプライン主要モジュール
- `ImageGenerator`：Pollinations.aiのURL APIで画像を取得。解像度・モデルは設定値で変更可能。
- `VoiceSynthesizer`：ローカルのVOICEVOX HTTP APIを呼び出し。接続不可時は無音WAVを生成して処理継続。文字数ベースの長さ推定も提供。
- `VideoGenerator`：MoviePyで各ページの画像配置とテキスト描画を行い、`##強調##`の赤色表示やBGM混在を実装。ただしタイプライター／フェード演出は無効化され静的表示となっている。
- `YouTubeUploader`：OAuth 2.0トークン管理とShortsタグ付け、任意の予約投稿に対応。動画ファイル存在と認証を検証してからアップロード。
- スクリプト入力は空行で区切る簡易テキスト形式を使用。`sample_script.yaml`には高度なタイムライン仕様が定義されているが、現在のコードでは未連携。

## 設定・アセット・依存関係
- 依存ライブラリはMoviePy/Pillow/OpenCV/NumPy等に加え、YouTube APIクライアント一式。`requirements.txt`は固定バージョン指定。
- 日本語太字表示用に`fonts/NotoSansJP-*.ttf`が同梱され、フォント探索で最優先利用。
- `test/image_gen_test.py`はPollinationsの疎通確認だけで、`config.yaml`が必須。
- `todo.md`はMVPタスクを網羅するが全て未完了のまま。

## リスクとギャップ
- `config.yaml`とBGMファイル（例: `music/motivation-music3.mp3`）が欠落しており、そのままでは実行できない。
- `image_generator.py.backup`はFlux統合の壊れた残骸。現在のPollinations実装はAPIキー管理や制限対策が無い。
- テキストアニメーションはスタブ状態で、仕様書にあるダイナミクスを再現できていない。
- ページ単位で逐次連結するのみで、シーン遷移やタイムライン管理、緻密な音合わせは存在しない。

## ロング動画化に向けた検討事項
- ページ積み上げからタイムライン駆動へ設計変更し、`sample_script.yaml`レベルのシーン定義を実装。絶対時間管理とテンプレート化が必要。
- Pollinations依存を見直し、長尺用に安定した画像／映像素材（SD系バッチ生成やストック映像）とキャッシュ機構を導入。
- 音声層を強化し、複数話者・BGMトラック・効果音をレイヤー管理。長尺向けの正規化とセクション別BGM制御を追加。
- アニメーションエンジンの再構築（タイプライターやフェード演出、下部ナレーション、ローワーサード等）。長尺用テンプレート／プリセットの管理が必要。
- 出力処理の堅牢化：長時間レンダリング向けのファイルストリーミング、リトライ、途中再開、FFmpeg直接利用の検討。
- YouTubeワークフローを通常動画重視に再設定し、チャプターやメタデータ拡張、レジューム可能アップロードの強化を検討。

## 推奨ステップ
1. 長尺運用を前提に`config.yaml`の雛形を作成し、APIキーやパス、テンポ管理を整理。
2. 拡張YAMLスクリプトを解析して`pages_data`を生成するタイムラインビルダーを試作。
3. 10分以上のスクリプトでMoviePyパイプラインをプロファイルし、必要に応じてFFmpeg直叩きやGPU支援レンダラへの置換を検討。
